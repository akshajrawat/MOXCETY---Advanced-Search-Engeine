services: # The list of "machines" we want to spin up
  db: # We name this service "db"
    image: postgres:15-alpine # The software to install (Postgres v15, Alpine Linux version)
    container_name: searchscale-pg

    # 1. Credentials
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}

    # 2. Port Mapping (Host : Container)
    # Allows your Windows machine (localhost:5432) to talk to the Container (5432)
    ports:
      - "${POSTGRES_PORT}:5432"

    # 3. Persistence (Volumes)
    # Maps a folder on your Windows machine to the folder inside Docker
    # This ensures that even if you delete Docker, your data survives in "./pgdata"
    volumes:
      - ./pgdata:/var/lib/postgresql/data

    # 4. Auto-restart
    # If the database crashes, Docker will automatically try to start it again
    restart: always
